flowchart TB
    %% Authorization Boundary
    subgraph boundary["<b>FedRAMP Authorization Boundary</b>"]
        direction TB

        subgraph vpc["<b>VPC: fedramp-complex-vpc (10.30.0.0/16)</b>"]
            direction TB

            %% Trust Zones
            subgraph public["<b>Public Tier - SC-7</b>"]
                igw[["<img src='https://cdn.prod.website-files.com/5f05d5858fab461d0d08eaeb/635a1c060b1a32823c9159d0_internet_gateway_light.svg' width='40'/><br/>Internet Gateway"]]
                nat[["<img src='https://cdn.prod.website-files.com/5f05d5858fab461d0d08eaeb/6358cec281674a47f95c499b_nat_gateway_light.svg' width='40'/><br/>NAT Gateway"]]
                alb[["<img src='https://icon.icepanel.io/AWS/svg/Networking-Content-Delivery/Elastic-Load-Balancing.svg' width='40'/><br/>Application Load Balancer<br/>ðŸ”’ TLSâ€¯1.2+"]]
            end

            subgraph app["<b>Application Tier - Private (AU-2)</b>"]
                ecs[["<img src='https://icon.icepanel.io/AWS/svg/Compute/ECS.svg' width='40'/><br/>ECS Service<br/>ðŸ”’ EBSâ€‘CMK"]]
                efs[["<img src='https://icon.icepanel.io/AWS/svg/Storage/Elastic-File-System.svg' width='40'/><br/>EFS<br/>ðŸ”’ KMS"]]
                ssm[["<img src='https://icon.icepanel.io/AWS/svg/Management-Governance/Systems-Manager-Parameter-Store.svg' width='40'/><br/>SSM Parameter<br/>ðŸ”’ KMS"]]
                secret[["<img src='https://icon.icepanel.io/AWS/svg/Security-Identity-Compliance/Secrets-Manager.svg' width='40'/><br/>Secrets Manager<br/>ðŸ”’ KMS"]]
            end

            subgraph data["<b>Data Tier - Encrypted (CM-2)</b>"]
                s3[["<img src='https://icon.icepanel.io/AWS/svg/Storage/Simple-Storage-Service.svg' width='40'/><br/>S3 Bucket<br/>ðŸ”’ KMS"]]
                sqs[["<img src='https://icon.icepanel.io/AWS/svg/Integration/Simple-Queue-Service.svg' width='40'/><br/>SQS Queue<br/>ðŸ”’ KMS"]]
                sns[["<img src='https://icon.icepanel.io/AWS/svg/Integration/Simple-Notification-Service.svg' width='40'/><br/>SNS Topic"]]
            end

            %% Security & Compliance
            subgraph security["<b>Security & Compliance - AC-6, AU-2</b>"]
                kms[["<img src='https://icon.icepanel.io/AWS/svg/Security-Identity-Compliance/Key-Management-Service.svg' width='40'/><br/>KMS CMK"]]
                cloudtrail[["<img src='https://icon.icepanel.io/AWS/svg/Management-Governance/CloudTrail.svg' width='40'/><br/>AWS CloudTrail"]]
                guardduty[["<img src='https://icon.icepanel.io/AWS/svg/Security-Identity-Compliance/GuardDuty.svg' width='40'/><br/>GuardDuty"]]
                config[["<img src='https://icon.icepanel.io/AWS/svg/Management-Governance/Config.svg' width='40'/><br/>AWS Config"]]
                vpcflow[["<img src='https://icon.icepanel.io/AWS/svg/Management-Governance/CloudWatch-Logs.svg' width='40'/><br/>VPC Flow Logs"]]
            end
        end
    end

    %% Data Flow
    internet["â˜ï¸ Internet"] --> igw
    igw --> alb
    alb --> ecs
    ecs --> efs
    ecs --> s3
    ecs --> sqs
    ecs --> sns
    ecs --> ssm
    ecs --> secret

    %% Security relations (no directional arrows required for compliance services)
    kms -.-> efs
    kms -.-> s3
    kms -.-> ssm
    kms -.-> secret
    cloudtrail -.-> s3
    guardduty -.-> vpcflow
    config -.-> vpcflow
    vpcflow -.-> kms

    %% Styling
    style boundary fill:#e3f2fd,stroke:#1976d2,stroke-width:4px,stroke-dasharray:10 5
    style public fill:#fff9c4,stroke:#fbc02d,stroke-width:2px
    style app fill:#c8e6c9,stroke:#2e7d32,stroke-width:2px
    style data fill:#bbdefb,stroke:#1565c0,stroke-width:2px
    style security fill:#f3e5f5,stroke:#6a1b9a,stroke-width:2px
